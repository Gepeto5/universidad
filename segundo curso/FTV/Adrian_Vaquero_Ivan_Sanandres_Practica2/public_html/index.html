<!DOCTYPE html>

<html>
    <head>
        <title>Práctica 2 de Fundamentos de Tecnología de Videojuegos</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>
            body{
                background-size: cover;
                background-image: url('fondo.jpg');
            }
            canvas{
                background-color: white;
                border: 1px solid black;
                margin: 10px;
                padding: 0;
            }
            button{
                background-color: fuchsia;
                border-radius: 3px;
                border: 3px solid darkturquoise;
                color: darkblue;
                font-size: 20px;
                font-family: courier;
                font-weight: bold; 
            }
        </style>
    </head>
    <body>
        <div align="center" style="text-align: center">
            <canvas id="lienzo">Tu navegador no soporta canvas</canvas>
        </div>
        <div align="center" style="color: white; font-size: 25px; font-family: courier; font-weight: bold">
            <button id="simulate">Jugar</button>
            <button id="stop">Pausar</button>
            <button id="clear">Limpiar</button>
            <button id="random">Aleatorizar</button>
            <button id="thanos">Botón del Infinito</button>
            <button id="arcade">Modo arcade</button>
            <audio id="snap">
                <source src="snap.mp3">
            </audio>
            <p id="simSteps"></p>
            <p id="cellSteps"></p>
            <p>Práctica 2 Fundamentos de Tecnología de Videojuegos<br />Adrián Vaquero Portillo, DNI: 53806658K<br />Iván Sanandrés Gutiérrez, DNI: 47587090K</p>
        </div>
        <script>
            var context; //darkolive green, darksea green, darkblue, darkturquoise, purple, black 
            var canvas = document.getElementById("lienzo");
            var simulate = document.getElementById("simulate");
            var stop = document.getElementById("stop");
            var simSteps = document.getElementById("simSteps");
            var cellSteps = document.getElementById("cellSteps");
            var random = document.getElementById("random");
            var clearCells = document.getElementById("clear");
            var thanos = document.getElementById("thanos");
            var snap = document.getElementById("snap");
            var arcademode = document.getElementById("arcade");

            function World() {
                var dimCuadro;
                var posCuadroX;
                var posCuadroY;
                const cell = 10;    //tamaño célula
                this.width = 80;    //número células en el ancho
                this.height = 80;   //número células en el alto
                var checkN = [width];
                var cellpos = [width];
                for (var i = 0; i < width; i++) {
                    cellpos[i] = [height];
                    checkN[i] = [height];
                    for (var j = 0; j < height; j++) {
                        cellpos[i][j] = new Cell();
                        cellpos[i][j].alive = false;
                        //cellpos[i][j].alive = randBool();
                    }
                }

                cellpos[1][0].alive = true;
                cellpos[1][1].alive = true;
                cellpos[1][2].alive = true;
                cellpos[5][0].alive = true;
                cellpos[5][1].alive = true;
                cellpos[6][0].alive = true;
                cellpos[6][2].alive = true;
                cellpos[7][1].alive = true;
                cellpos[25][25].alive = true;
                cellpos[25][26].alive = true;
                cellpos[26][25].alive = true;
                cellpos[26][27].alive = true;
                cellpos[27][25].alive = true;
                canvas.width = width * cell;
                canvas.height = height * cell;

                context = canvas.getContext("2d");
                context.strokeStyle = "lightgrey";
                context.fillStyle = "black";

                function checkNeighbours(x, y) {
                    var count = 0;

                    for (var i = -1; i < 2; i++) {
                        for (var j = -1; j < 2; j++) {
                            var aux1 = (x + i + width) % width;
                            var aux2 = (y + j + height) % height;
                            if (!(i === 0 && j === 0) && cellpos[aux1][aux2].alive === true) {
                                count++;
                            }
                        }
                    }
                    return count;
                }

                function printCells() {
                    for (var x = 0; x < width; x++) {
                        for (var y = 0; y < height; y++) {
                            if (cellpos[x][y].alive) {
                                context.fillStyle = "darkblue";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            } else if (!cellpos[x][y].alive) {
                                context.fillStyle = "darkturquoise";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            }
                        }
                    }
                }

                function printCellsThanos() {
                    for (var x = 0; x < width; x++) {
                        for (var y = 0; y < height; y++) {
                            if (cellpos[x][y].alive) {
                                context.fillStyle = "black";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            } else if (!cellpos[x][y].alive) {
                                context.fillStyle = "purple";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            }
                        }
                    }
                }

                function printCellsArcade() {
                    for (var x = 0; x < width; x++) {
                        for (var y = 0; y < height; y++) {
                            if (cellpos[x][y].alive) {
                                context.fillStyle = "darkolivegreen";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            } else if (!cellpos[x][y].alive) {
                                context.fillStyle = "darkseagreen";
                                context.fillRect(x * cell, y * cell, cell, cell);
                            }
                        }
                    }
                }

                var counterSteps = 0;
                function life() {
                    for (var x = 0; x < width; x++) {
                        for (var y = 0; y < height; y++) {
                            checkN[x][y] = checkNeighbours(x, y);
                        }
                    }
                    for (var x = 0; x < width; x++) {
                        for (var y = 0; y < height; y++) {
                            cellpos[x][y].time++;
                            if (cellpos[x][y].alive === false && checkN[x][y] === 3) {
                                cellpos[x][y].alive = true;
                                cellpos[x][y].time = 0;
                            } else if (cellpos[x][y].alive === true && !(checkN[x][y] === 2 || checkN[x][y] === 3)) {
                                cellpos[x][y].alive = false;
                                cellpos[x][y].time = 0;
                            }
                        }
                    }
                    if (cellpos[posCuadroX][posCuadroY].alive === true) {
                        cellSteps.innerHTML = "La célula (" + (posCuadroX + 1) + ", " + (posCuadroY + 1) + ") lleva viva " + cellpos[posCuadroX][posCuadroY].time + " pasos.";
                    } else if (cellpos[posCuadroX][posCuadroY].alive === false) {
                        cellSteps.innerHTML = "La célula (" + (posCuadroX + 1) + ", " + (posCuadroY + 1) + ") lleva muerta " + cellpos[posCuadroX][posCuadroY].time + " pasos.";
                    }
                    counterSteps++;
                    simSteps.innerHTML = "Pasos de la simulación " + counterSteps;
                }

                printCells();
                var print, sim, printArcade;
                var simNow = false;
                var arcadeActivated = false;

                function simulateLife() {
                    if (simNow === false && arcadeActivated === false) {
                        print = setInterval(printCells, 100);
                        sim = setInterval(life, 100);
                        simNow = true;
                    } else if (simNow === false && arcadeActivated === true) {
                        printArcade = setInterval(printCellsArcade, 100);
                        sim = setInterval(life, 100);
                        simNow = true;
                    }
                }

                function stopSimulation() {
                    if (simNow === true) {
                        clearInterval(print);
                        clearInterval(sim);
                        simNow = false;
                    }
                }

                function clear() {
                    for (var i = 0; i < width; i++) {
                        for (var j = 0; j < height; j++) {
                            cellpos[i][j].alive = false;
                        }
                    }
                    if (arcadeActivated === false) {
                        printCells();
                    } else if (arcadeActivated === true) {
                        printCellsArcade();
                    }
                }

                function randomize() {
                    for (var i = 0; i < width; i++) {
                        for (var j = 0; j < height; j++) {
                            cellpos[i][j].alive = randBool();
                        }
                    }
                    if (arcadeActivated === false) {
                        printCells();
                    } else if (arcadeActivated === true) {
                        printCellsArcade();
                    }
                }

                function thanosButton() {
                    for (var i = 0; i < width; i++) {
                        for (var j = 0; j < height; j++) {
                            if (cellpos[i][j].alive) {
                                cellpos[i][j].alive = randBool();
                            }
                        }
                    }
                    printCellsThanos();
                    snap.play();
                }

                function arcadeM() {
                    if (arcadeActivated === false) {
                        stopSimulation();
                        printCellsArcade();
                        arcadeActivated = true;
                        simulateLife();
                    } else if (arcadeActivated === true) {
                        stopSimulation();
                        printCells();
                        arcadeActivated = false;
                        simulateLife();
                    }
                }

                random.addEventListener("click", randomize, false);
                clearCells.addEventListener("click", clear, false);
                thanos.addEventListener("click", thanosButton, false);
                arcademode.addEventListener("click", arcadeM, false);
                simulate.addEventListener("click", simulateLife, false);
                stop.addEventListener("click", stopSimulation, false);

                canvas.addEventListener("click", clickCell, true);
                canvas.addEventListener("click", statusCell, true);
                canvas.addEventListener("mousemove", statusCell, false);
                function clickCell(e) {
                    var dimCuadro = this.getBoundingClientRect();
                    var posCuadroX = parseInt((e.pageX - dimCuadro.left) / cell);
                    var posCuadroY = parseInt((e.pageY - dimCuadro.top) / cell);
                    if (cellpos[posCuadroX][posCuadroY].alive === true && e.type === "click") {
                        cellpos[posCuadroX][posCuadroY].alive = false;
                        cellpos[posCuadroX][posCuadroY].time = 0;
                    } else if (cellpos[posCuadroX][posCuadroY].alive === false && e.type === "click") {
                        cellpos[posCuadroX][posCuadroY].alive = true;
                        cellpos[posCuadroX][posCuadroY].time = 0;
                    }
                    printCells();
                }

                function statusCell(e) {
                    dimCuadro = this.getBoundingClientRect();
                    posCuadroX = parseInt((e.pageX - dimCuadro.left) / cell);
                    posCuadroY = parseInt((e.pageY - dimCuadro.top) / cell);
                    if (cellpos[posCuadroX][posCuadroY].alive === true) {
                        cellSteps.innerHTML = "La célula (" + (posCuadroX + 1) + ", " + (posCuadroY + 1) + ") lleva viva " + cellpos[posCuadroX][posCuadroY].time + " pasos.";
                    } else if (cellpos[posCuadroX][posCuadroY].alive === false) {
                        cellSteps.innerHTML = "La célula (" + (posCuadroX + 1) + ", " + (posCuadroY + 1) + ") lleva muerta " + cellpos[posCuadroX][posCuadroY].time + " pasos.";
                    }
                }
            }

            function Cell(alive) {
                this.alive = alive;
                this.time = 0;
            }

            function randBool() {
                var num = Math.floor((Math.random() * 2) + 1);
                if (num === 1) {
                    return true;
                } else {
                    return false;
                }

            }

            World(); //HOLD ON

        </script>
    </body>
</html>
